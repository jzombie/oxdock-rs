# TODO: If possible, gate this so that #[cfg(miri)] is mostly only contained within oxdock-fs
# and oxdock-process crates, where the other crates are agnostic to the test runner.

# TODO: Update this description to cover "types" and "processes"
# Disallowed methods to ensure filesystem access in `oxdock-core` goes through PathResolver.
# Clippy will emit the `disallowed_methods` lint for any exact matches.
# Note: this configuration works with Clippy (cargo clippy). It will not by itself
# make `cargo build` fail unless `cargo clippy` is run and the lint is denied.

# The list below was provided by the user; each entry includes a short note.
disallowed-methods = [
  "std::boxed::Box::leak",
  "std::fs::read",
  "std::fs::read_to_string",
  "std::fs::read_dir",
  "std::fs::File::open",
  "std::fs::OpenOptions::open",
  "std::fs::metadata",
  "std::fs::symlink_metadata",
  "std::fs::canonicalize",
  "std::fs::remove_dir_all",
  "std::fs::remove_file",
  "std::fs::create_dir_all",
  "std::fs::create_dir",
  "std::fs::copy",
  "std::fs::rename",
  "std::fs::write",
  "std::path::Path::canonicalize",
  "std::path::Path::new",
  "tempfile::tempdir",
  "tempfile::Builder::tempdir",
  "std::process::Command::new",
  "std::process::Command::spawn",
  "std::process::Command::status",
  "std::process::Command::output",
  "std::process::Command::arg",
  "std::process::Command::args",
  "std::process::Command::current_dir",
]

# Keep std::path usage funneled through the filesystem abstraction.
disallowed-types = [
  "std::path::Path",
  "std::path::PathBuf",
  "std::fs::OpenOptions",
  "oxdock_fs::UnguardedPath",
  "tempfile::Builder",
  "std::process::Command",
  "std::process::Child",
  "std::process::Stdio",
  "std::process::Output"
]
